"use strict";(self.webpackChunk_420_w_50_sf=self.webpackChunk_420_w_50_sf||[]).push([[8176],{8203:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>a,metadata:()=>i,toc:()=>u});const i=JSON.parse('{"id":"Notes de cours/AuthentificationFirebase","title":"Authentification avec Firebase","description":"Mise en place de la configuration","source":"@site/docs/Notes de cours/9-AuthentificationFirebase.md","sourceDirName":"Notes de cours","slug":"/Notes de cours/AuthentificationFirebase","permalink":"/420-W50-SF/docs/Notes de cours/AuthentificationFirebase","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":9,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Introduction aux appels API dans React Native","permalink":"/420-W50-SF/docs/Notes de cours/appelsApi"}}');var s=t(4848),r=t(8453);const a={},o="Authentification avec Firebase",c={},u=[{value:"Mise en place de la configuration",id:"mise-en-place-de-la-configuration",level:2},{value:"Troubleshooting (optionnel)",id:"troubleshooting-optionnel",level:2},{value:"Context d&#39;authentification",id:"context-dauthentification",level:2},{value:"Routage de base de l&#39;application",id:"routage-de-base-de-lapplication",level:2},{value:"R\xe8gles de routage dans le useEffect",id:"r\xe8gles-de-routage-dans-le-useeffect",level:3}];function l(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"authentification-avec-firebase",children:"Authentification avec Firebase"})}),"\n",(0,s.jsx)(n.h2,{id:"mise-en-place-de-la-configuration",children:"Mise en place de la configuration"}),"\n",(0,s.jsxs)(n.p,{children:["Au moment de lire ces lignes, vous avez d\xe9j\xe0 cr\xe9\xe9 un projet ",(0,s.jsx)(n.strong,{children:"Firebase"})," nomm\xe9 ",(0,s.jsx)(n.code,{children:"ExerciceFirebase"})," dans le tutoriel de configuration. Copiez sa configuration en acc\xe9dant \xe0 ses param\xe8tres (voir tutoriel)."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Important"})," : Une configuration ",(0,s.jsx)(n.strong,{children:"Firebase"})," est pour un projet en particulier et non pour le compte en g\xe9n\xe9ral. Dans les travaux subs\xe9quents, vous cr\xe9erez d'autres projets ",(0,s.jsx)(n.strong,{children:"Firebase"}),", il sera important de copier la configuration du bon projet !"]}),"\n",(0,s.jsxs)(n.p,{children:["\xc0 la racine de votre application React Native (au m\xeame niveau que ",(0,s.jsx)(n.code,{children:"app"}),", pas dans ",(0,s.jsx)(n.code,{children:"app"}),"), cr\xe9ez un fichier nomm\xe9 ",(0,s.jsx)(n.code,{children:"firebaseConfig.ts"})]}),"\n",(0,s.jsxs)(n.p,{children:["Les ",(0,s.jsx)(n.em,{children:"imports"})," seront les suivants :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:'import { initializeApp } from "firebase/app";\r\nimport { initializeAuth, getReactNativePersistence } from "firebase/auth";\r\nimport AsyncStorage from "@react-native-async-storage/async-storage";\n'})}),"\n",(0,s.jsx)(n.p,{children:"Ensuite, le bloc de configuration sera la v\xf4tre. Nous allons imm\xe9diatement isoler les valeurs dans des variables d'environnement :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"const firebaseConfig = {\r\n  apiKey: process.env.EXPO_PUBLIC_FIREBASE_API_KEY,\r\n  authDomain: process.env.EXPO_PUBLIC_FIREBASE_AUTH_DOMAIN,\r\n  projectId: process.env.EXPO_PUBLIC_FIREBASE_PROJECT_ID,\r\n  storageBucket: process.env.EXPO_PUBLIC_FIREBASE_STORAGE_BUCKET,\r\n  messagingSenderId: process.env.EXPO_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,\r\n  appId: process.env.EXPO_PUBLIC_FIREBASE_APP_ID,\r\n};\n"})}),"\n",(0,s.jsxs)(n.p,{children:["et dans un nouveau fichier ",(0,s.jsx)(n.code,{children:".env"}),", lui aussi au m\xeame niveau que ",(0,s.jsx)(n.code,{children:"app"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-env",children:"EXPO_PUBLIC_FIREBASE_API_KEY=/*votre cl\xe9*/\r\nEXPO_PUBLIC_FIREBASE_AUTH_DOMAIN=/*votre domaine*/\r\nEXPO_PUBLIC_FIREBASE_PROJECT_ID=/*votre projet*/\r\nEXPO_PUBLIC_FIREBASE_STORAGE_BUCKET=/*votre bucket*/\r\nEXPO_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=/*votre sender id*/\r\nEXPO_PUBLIC_FIREBASE_APP_ID=/*votre app id*/\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Terminez le fichier de configuration ",(0,s.jsx)(n.strong,{children:"Firebase"})," avec ces instructions:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"const app = initializeApp(firebaseConfig);\r\n\r\nexport const auth = initializeAuth(app, {\r\n  persistence: getReactNativePersistence(AsyncStorage),\r\n});\n"})}),"\n",(0,s.jsxs)(n.p,{children:["On voit notamment que l'authentification ",(0,s.jsx)(n.strong,{children:"Firebase"})," utilisera le storage local pour persister l'utilisateur connect\xe9."]}),"\n",(0,s.jsx)(n.h2,{id:"troubleshooting-optionnel",children:"Troubleshooting (optionnel)"}),"\n",(0,s.jsx)(n.p,{children:"Si l'import suivant vous cause probl\xe8me :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:'import { initializeAuth, getReactNativePersistence } from "firebase/auth";\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Remplacez le contenu du fichier ",(0,s.jsx)(n.code,{children:"tsconfig.json"})," par :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:'{\r\n  "extends": "expo/tsconfig.base",\r\n  "compilerOptions": {\r\n    "strict": true,\r\n    "paths": {\r\n      "@/*": [\r\n        "./*"\r\n      ],\r\n      "@firebase/auth": ["./node_modules/@firebase/auth/dist/index.rn.d.ts"]\r\n    }\r\n  },\r\n  "include": [\r\n    "**/*.ts",\r\n    "**/*.tsx",\r\n    ".expo/types/**/*.ts",\r\n    "expo-env.d.ts"\r\n  ]\r\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"context-dauthentification",children:"Context d'authentification"}),"\n",(0,s.jsxs)(n.p,{children:["La mise en place du contexte d'authentification est similaire aux autres contextes mis en place dans le cadre du cours. On y retrouvera notamment un ",(0,s.jsx)(n.strong,{children:"statut authentifi\xe9 (ou non)"})," ainsi que les m\xe9thodes usuelles (signup, signin, signout)."]}),"\n",(0,s.jsxs)(n.p,{children:["Le contexte doit contenir ce ",(0,s.jsx)(n.code,{children:"useEffect"})," crucial qui prend effet au premier rendu du contexte:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"useEffect(() => {\r\n  const unsub = onAuthStateChanged(auth, (user) => {\r\n    if (user) {\r\n      setIsAuthenticated(true);\r\n    } else {\r\n      setIsAuthenticated(false);\r\n    }\r\n  });\r\n  return unsub;\r\n}, []);\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Le param\xe8tre ",(0,s.jsx)(n.code,{children:"auth"})," fait r\xe9f\xe9rence \xe0 la variable d\xe9clar\xe9e dans le fichier de configuration de Firebase cod\xe9 plus haut."]}),"\n",(0,s.jsxs)(n.p,{children:["Il permet de programmer un \xe9couteur de statut d'authentification qui vit ",(0,s.jsx)(n.strong,{children:"tant et aussi longtemps que le contexte n'est pas recharg\xe9"})," (rappel : useEffect avec return)."]}),"\n",(0,s.jsxs)(n.p,{children:["La m\xe9canique est simple, aussit\xf4t que le statut de l'authentification change, cet \xe9couteur est appel\xe9. si un ",(0,s.jsx)(n.code,{children:"user"}),' est r\xe9cup\xe9r\xe9, le statut est inscrit \xe0 "authentifi\xe9", le cas contraire si ',(0,s.jsx)(n.code,{children:"user"})," est null."]}),"\n",(0,s.jsxs)(n.p,{children:["En b\xe9n\xe9ficiant de la persistence, il est possible qu'un ",(0,s.jsx)(n.code,{children:"user"})," soit pr\xe9sent au d\xe9marrage du contexte, provoquant un ",(0,s.jsx)(n.code,{children:"onAuthStateChanged"}),", ce qui nous am\xe8nerait directement \xe0 la partie authentifi\xe9e de l'application."]}),"\n",(0,s.jsx)(n.p,{children:"Le reste du contexte est tel que vu au cours."}),"\n",(0,s.jsx)(n.h2,{id:"routage-de-base-de-lapplication",children:"Routage de base de l'application"}),"\n",(0,s.jsxs)(n.p,{children:["La composition du layout de base est identique \xe0 celle vue auparavant, elle pr\xe9voira cependant une m\xe9canique de routage (avec ",(0,s.jsx)(n.strong,{children:"expo router"}),") en r\xe9action au changement d'authentification dans l'application :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"function MainLayout() {\r\n  //Utilisation du hook d'authentification\r\n  //Utilisation du routeur expo\r\n  //Utilisation des segments (pour inspecter la composition de la route courante)\r\n  //https://docs.expo.dev/versions/latest/sdk/router/#usesegments\r\n  \r\n  \r\n  \r\n  //Ici, un useEffect bas\xe9 sur l'\xe9tat authentifi\xe9 du contexte :\r\n  //Voir plus bas pour les r\xe8gles de routage\r\n\r\n  //Ici un activity indicator si le statut d'authentification est undefined ...\r\n\r\n  //... ou bien le chargement de la Stack de layout\r\n}\r\n\r\nexport default function RootLayout() {\r\n  return (\r\n    <AuthContextProvider>\r\n      <MainLayout />\r\n    </AuthContextProvider>\r\n  );\r\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"r\xe8gles-de-routage-dans-le-useeffect",children:"R\xe8gles de routage dans le useEffect"}),"\n",(0,s.jsx)(n.p,{children:"En utilisant les segments de route :"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Si le ",(0,s.jsx)(n.em,{children:"state"})," est ",(0,s.jsx)(n.code,{children:"undefined"}),", on ne fait rien dans le ",(0,s.jsx)(n.code,{children:"useEffect"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Si le ",(0,s.jsx)(n.em,{children:"state"})," est ",(0,s.jsx)(n.strong,{children:"authentifi\xe9"})," et qu\u2019on n\u2019est pas d\xe9j\xe0 dans une route ",(0,s.jsx)(n.code,{children:"(auth)"}),", on navigue vers l\u2019index (",(0,s.jsx)(n.code,{children:"/"}),").","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Cas classique : un utilisateur s\u2019inscrit ou se connecte depuis une page publique."}),"\n",(0,s.jsxs)(n.li,{children:["Avantage : Par exemple, s\u2019il est d\xe9j\xe0 dans ",(0,s.jsx)(n.code,{children:"(auth)"})," et qu\u2019il met \xe0 jour son profil (changement dans le ",(0,s.jsx)(n.em,{children:"user"}),", ce qui red\xe9clenchera ici un ",(0,s.jsx)(n.code,{children:"onAuthStateChanged"})," avec un \xe9tat toujours authentifi\xe9), on ne naviguera pas inutilement."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Si l\u2019utilisateur n\u2019est ",(0,s.jsx)(n.strong,{children:"pas authentifi\xe9"}),", on navigue vers ",(0,s.jsx)(n.strong,{children:"/login"}),"."]}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>o});var i=t(6540);const s={},r=i.createContext(s);function a(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);